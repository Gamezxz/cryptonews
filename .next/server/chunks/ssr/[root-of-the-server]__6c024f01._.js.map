{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../components/ChatWidget.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client';\n\nimport { useState, useRef, useEffect } from 'react';\n\nfunction getBaseUrl() {\n  if (typeof window !== 'undefined') return window.location.origin;\n  return process.env.NEXT_PUBLIC_API_URL || 'http://localhost:13002';\n}\n\nexport default function ChatWidget() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages, loading]);\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isOpen]);\n\n  async function handleSend() {\n    const text = input.trim();\n    if (!text || loading) return;\n\n    const userMsg = { role: 'user', content: text };\n    setMessages(prev => [...prev, userMsg]);\n    setInput('');\n    setLoading(true);\n\n    try {\n      const history = messages.slice(-6);\n      const res = await fetch(`${getBaseUrl()}/api/chat`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message: text, history }),\n      });\n\n      const json = await res.json();\n\n      if (json.success) {\n        setMessages(prev => [...prev, {\n          role: 'assistant',\n          content: json.answer,\n          sources: json.sources || [],\n        }]);\n      } else {\n        setMessages(prev => [...prev, {\n          role: 'assistant',\n          content: json.error || 'เกิดข้อผิดพลาด กรุณาลองใหม่',\n        }]);\n      }\n    } catch {\n      setMessages(prev => [...prev, {\n        role: 'assistant',\n        content: 'ไม่สามารถเชื่อมต่อ AI ได้ กรุณาลองใหม่',\n      }]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function handleKeyDown(e) {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  }\n\n  return (\n    <>\n      {/* Floating button */}\n      <button\n        className=\"chat-fab\"\n        onClick={() => setIsOpen(!isOpen)}\n        aria-label={isOpen ? 'Close chat' : 'Open AI chat'}\n      >\n        {isOpen ? '✕' : 'AI'}\n      </button>\n\n      {/* Chat window */}\n      {isOpen && (\n        <div className=\"chat-window\">\n          <div className=\"chat-header\">\n            <span className=\"chat-header-icon\">AI</span>\n            <span>CRYPTO NEWS AI</span>\n            <button className=\"chat-close\" onClick={() => setIsOpen(false)}>✕</button>\n          </div>\n\n          <div className=\"chat-messages\">\n            {messages.length === 0 && (\n              <div className=\"chat-welcome\">\n                <p>สวัสดีครับ! ผมเป็น AI ผู้ช่วยวิเคราะห์ข่าว Crypto</p>\n                <p>ถามอะไรก็ได้เกี่ยวกับข่าว crypto ล่าสุด เช่น:</p>\n                <div className=\"chat-suggestions\">\n                  <button onClick={() => { setInput('Bitcoin ตอนนี้เป็นยังไงบ้าง?'); }}>Bitcoin ตอนนี้เป็นยังไง?</button>\n                  <button onClick={() => { setInput('สรุปข่าว Ethereum ล่าสุด'); }}>สรุปข่าว Ethereum ล่าสุด</button>\n                  <button onClick={() => { setInput('What are the trending topics today?'); }}>Trending topics today?</button>\n                </div>\n              </div>\n            )}\n\n            {messages.map((msg, i) => (\n              <div key={i} className={`chat-msg chat-msg-${msg.role}`}>\n                <div className=\"chat-bubble\">\n                  {msg.content}\n                </div>\n                {msg.sources && msg.sources.length > 0 && (\n                  <div className=\"chat-sources\">\n                    {msg.sources.map((s, j) => (\n                      <a key={j} href={`/news/${s.slug}`} className=\"chat-source-chip\">\n                        {s.source}\n                      </a>\n                    ))}\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {loading && (\n              <div className=\"chat-msg chat-msg-assistant\">\n                <div className=\"chat-bubble chat-typing\">\n                  <span></span><span></span><span></span>\n                </div>\n              </div>\n            )}\n\n            <div ref={messagesEndRef} />\n          </div>\n\n          <div className=\"chat-input-area\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              className=\"chat-input\"\n              placeholder=\"ถามเกี่ยวกับข่าว crypto...\"\n              value={input}\n              onChange={(e) => setInput(e.target.value.slice(0, 500))}\n              onKeyDown={handleKeyDown}\n              disabled={loading}\n            />\n            <button\n              className=\"chat-send\"\n              onClick={handleSend}\n              disabled={loading || !input.trim()}\n            >\n              ›\n            </button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}